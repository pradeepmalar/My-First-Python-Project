import firebase_admin
from firebase_admin import credentials,db

cred = credentials.Certificate("key.json")
firebase_admin.initialize_app(cred,{"databaseURL":"https://python1-929e1-default-rtdb.firebaseio.com/"})
store=db.reference("/")

userchoice=input("If signup 's',or login 'l'")

if(userchoice=='s'):
    print("Signup now")
    
    username=input("enter username")
    
    pswd=input("Enter password")
    while(len(pswd)<6):
        pswd=input("Enter password,min.6 characters")

    mobnum=input("Enter mobilenumber")
    while((len(mobnum)!=10)or (not(mobnum.isdigit()))):
        mobnum=input("Enter proper mobilenumber")

    email=input("Enter the email id")
    while('@' not in email):
        email=input("Enter proper email id")
        
    store.child(username).update({"uname":username,"password":pswd,"phonenum":mobnum,"emailid":email})

    print("Signup successful")
    userchoice='l'

if(userchoice=='l'):
    print("Login")
    
    for i in range(3):
        username2=input("Enter the username")
        pswd2=input("Enter the password")
        
        details=store.child(username2).get()
        
        if details is None:
            print("Wrong credentials. Attempts left:",2-i)
            
            if(i==2):
                print("Account blocked")
                break
                
        else:
            if(username2==details["uname"] and pswd2==details["password"]):
                print("Login successful")
                break
                
            else:
                print("Wrong credentials. Attempts left:",2-i)
                
                if(i==2):
                    print("Account blocked")
                    break
    

else:
    print("Invalid input")
